<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>

<style>
body{margin:0;font-family:Tahoma;background:#fff}
header{text-align:center;border-bottom:3px solid #0a3cff;padding:15px}
header img{height:90px}
#datetime{font-size:22px;font-weight:bold;margin-top:10px}
.container{max-width:1000px;margin:auto;padding:20px}
input,textarea,button{width:100%;padding:14px;margin:6px 0;font-size:20px}
button{background:#0a3cff;color:#fff;border:none;cursor:pointer}
button:hover{opacity:.9}
.hidden{display:none}
.card{border:2px solid #0a3cff;border-radius:8px;margin:10px 0}
.card-header{padding:15px;font-size:22px;background:#f3f6ff;cursor:pointer}
.card-body{display:none;padding:15px;font-size:20px}
.plate{border:2px solid #000;padding:10px;font-size:24px;font-weight:bold;display:inline-block;margin-bottom:10px}
.warn{color:red;font-weight:bold}
footer{text-align:center;border-top:2px solid #0a3cff;padding:15px;font-size:18px}
.iconBtn{width:auto;padding:10px 20px;margin:5px;font-size:18px}
</style>
</head>

<body>

<header>
<img src="logo.png">
<div id="datetime"></div>
</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

<h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h2>
<button onclick="openForm()">â• Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</button>

<!-- FORM -->
<div id="carForm" class="hidden">
<hr>
<input id="plateCode" placeholder="Ø±Ù…Ø² Ø§Ù„Ù„ÙˆØ­Ø©">
<input id="plateNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©">
<input id="owner" placeholder="Ø§Ù„Ù…Ø§Ù„Ùƒ">
<input id="user" placeholder="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input id="type" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
<input id="year" placeholder="Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹">
<input type="date" id="licenseEnd">
<input type="date" id="insuranceEnd">
<textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
<button onclick="saveCar()">Ø­ÙØ¸</button>
<button onclick="closeForm()">Ø¥Ù„ØºØ§Ø¡</button>
<hr>
</div>

<div id="carsList"></div>
</div>
</div>

<footer>Â© Developed by Mohamed Saad</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const app=initializeApp({
apiKey:"AIzaSyCvrNKiue6lIvJVkgFXWwiYMEY3rWdmj4g",
authDomain:"my-car123.firebaseapp.com",
projectId:"my-car123",
storageBucket:"my-car123.firebasestorage.app",
messagingSenderId:"731889650556",
appId:"1:731889650556:web:9c1fb521647131f48db2f9"
});

const auth=getAuth(app);
const db=getFirestore(app);

let printContent="";

// LOGIN
window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value)
.then(()=>alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­"))
.catch(e=>alert(e.message));

// AUTH
onAuthStateChanged(auth,u=>{
if(u){loginBox.classList.add("hidden");dashboard.classList.remove("hidden");loadCars();}
else{loginBox.classList.remove("hidden");dashboard.classList.add("hidden");}
});

// FORM
window.openForm=()=>carForm.classList.remove("hidden");
window.closeForm=()=>carForm.classList.add("hidden");

// SAVE
window.saveCar=async()=>{
await addDoc(collection(db,"cars"),{
plate:`${plateCode.value} ${plateNumber.value}`,
owner:owner.value,
user:user.value,
type:type.value,
year:year.value,
licenseEnd:licenseEnd.value,
insuranceEnd:insuranceEnd.value,
notes:notes.value
});
closeForm();
};

// DELETE WITH CONFIRM
window.deleteCar=async(id)=>{
if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŸ")){
await deleteDoc(doc(db,"cars",id));
}
};

// PRINT CARD ONLY
window.printCar=(html)=>{
const w=window.open("","","width=800,height=600");
w.document.write(`<html><body>${html}</body></html>`);
w.document.close();
w.print();
w.close();
};

// LOAD
function loadCars(){
onSnapshot(collection(db,"cars"),snap=>{
carsList.innerHTML="";
snap.forEach(d=>{
const c=d.data();
const now=new Date();
const lic=new Date(c.licenseEnd);
const diff=Math.ceil((lic-now)/86400000);
const cardHTML=`
<div>
<div class="plate">${c.plate}</div><br>
Ø§Ù„Ù…Ø§Ù„Ùƒ: ${c.owner}<br>
Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${c.type}<br>
Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹: ${c.year}<br>
${diff<=15?'<div class="warn">âš ï¸ Ø§Ù„ØªØ±Ø®ÙŠØµ Ù‚Ø§Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</div>':''}
</div>`;
carsList.innerHTML+=`
<div class="card">
<div class="card-header">${c.plate} - ${c.owner}</div>
<div class="card-body">
${cardHTML}
<button class="iconBtn" onclick="printCar(\`${cardHTML}\`)">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
<button class="iconBtn" onclick="deleteCar('${d.id}')">ğŸ—‘ Ø­Ø°Ù</button>
</div>
</div>`;
});
document.querySelectorAll(".card-header").forEach(h=>{
h.onclick=()=>{const b=h.nextElementSibling;b.style.display=b.style.display=="block"?"none":"block";}
});
});
}

// TIME
setInterval(()=>datetime.innerText=new Date().toLocaleString("en-GB"),1000);
</script>

</body>
</html>